# NRG Legislative Intelligence - Configuration
# Shared config for POC 2 and V2 pipelines
#
# Section Labels:
#   [SHARED]  - Used by both POC 2 and V2 pipelines
#   [V2 ONLY] - Used exclusively by V2 pipeline
#   [POC 2]   - Legacy settings for POC 2 compatibility

# ============================================================================
# LOGGING & DEBUGGING [V2 ONLY]
# ============================================================================
logging:
  # Logging level: normal (with traces) or debug (all details)
  level: normal

  # [V2 ONLY] Show detailed traces for each pipeline stage
  trace:
    sequential_evolution: true    # Show version-by-version analysis
    two_tier_validation: true     # Show judge validation decisions
    rubric_scoring: true          # Show per-dimension scoring rationale
    hallucination_detection: true # Explain why findings were flagged
    stability_analysis: true      # Show stability score calculations

  # Output formatting
  format:
    show_timestamps: true
    show_token_counts: true
    show_cost_estimates: true
    use_colors: true

# [POC 2] Legacy debug flags (for POC 2 compatibility)
debug:
  enabled: true
  api_order: true
  analysis_order: true
  llm_calls: false
  llm_responses: false
  change_detection: false

# ============================================================================
# LLM CONFIGURATION [SHARED]
# ============================================================================
llm:
  # Primary provider: gemini, openai, anthropic
  provider: gemini

  openai:
    api_key_env: OPENAI_API_KEY
    model: gpt-5
    reasoning_effort: medium
    verbosity: high

  gemini:
    api_key_env: GOOGLE_API_KEY
    model: gemini-3-pro-preview
    temperature: 0.2
    max_output_tokens: 8192

  anthropic:
    api_key_env: ANTHROPIC_API_KEY
    model: claude-sonnet-4-20250514

# ============================================================================
# V2 PIPELINE CONFIGURATION [V2 ONLY]
# ============================================================================
# All settings in this section are exclusive to the V2 pipeline
v2:
  # Orchestration settings
  orchestration:
    # Route bills based on complexity score
    complexity_thresholds:
      standard_max: 0      # 0 points → STANDARD route [TEMPORARY: lowered from 2 for testing; calibrate after full testing cycle]
      enhanced_min: 1      # 1+ points → ENHANCED route [TEMPORARY: lowered from 3 for testing; calibrate after full testing cycle]

    # Complexity scoring weights
    scoring:
      pages_20_50: 1       # 20-50 pages
      pages_over_50: 2     # >50 pages
      versions_2_5: 1      # 2-5 versions
      versions_over_5: 2   # >5 versions
      domain_environmental: 1
      domain_energy_tax: 2

  # Sequential Evolution settings
  sequential_evolution:
    enabled: true
    max_memory_tokens: 2000
    extract_quotes: true
    track_modifications: true

  # Two-Tier Validation settings
  two_tier:
    enabled: true

    # Tier 1.5: Multi-sample check
    multi_sample:
      enabled: true
      samples: 3
      agreement_threshold: 0.85
      # Only trigger if impact >= threshold OR confidence < threshold
      impact_trigger: 6
      confidence_trigger: 0.7

    # Tier 2: Judge validation
    judge:
      enabled: true
      verify_quotes: true
      detect_hallucinations: true

    # Tier 2.5: Fallback model
    fallback:
      enabled: true
      # Only trigger if judge confidence in range AND impact >= threshold
      confidence_range: [0.6, 0.8]
      impact_threshold: 7
      provider: anthropic  # Use different provider than primary

  # Rubric scoring settings
  rubric_scoring:
    enabled: true
    dimensions:
      - legal_risk
      - financial_impact
      - operational_disruption
      - ambiguity_risk
    # Score anchors (0-10 scale)
    anchors:
      low: [0, 2]
      medium: [3, 5]
      high: [6, 8]
      critical: [9, 10]

# ============================================================================
# DATA SOURCES [SHARED]
# ============================================================================
sources:
  # [V2 ONLY] Congress.gov - Federal bills from Congress.gov API
  congress:
    enabled: true
    limit: 3

  # [V2 ONLY] Regulations.gov - Federal regulations
  regulations:
    enabled: true
    limit: 3

  # LegiScan - Multi-state bills (DEPRECATED - Open States is superior)
  legiscan_federal:
    enabled: false
    limit: 3
    state: US

  # [V2 ONLY] Open States - State bills (PRIMARY SOURCE for state legislation)
  openstates:
    enabled: true
    api_key_env: OPENSTATES_API_KEY
    federal:
      enabled: false
      jurisdiction: US
      limit: 3
      search_query: oil and gas
    texas_bills:
      enabled: true
      jurisdiction: TX
      bills:
        - HB4238
        - HB391

# ============================================================================
# CHANGE TRACKING [SHARED]
# ============================================================================
change_tracking:
  enabled: true
  database: bill_cache.db
  track_text_changes: true
  track_amendments: true
  track_status_changes: true
  analyze_changes_with_llm: true
  min_check_interval_hours: 0

# ============================================================================
# VERSION TRACKING [SHARED]
# ============================================================================
version_tracking:
  enabled: true
  fetch_all_versions: true
  analyze_all_versions: true
  compare_versions: true
  include_version_timeline_in_reports: true
  sources:
    openstates: true
    congress: true
    regulations: false

# ============================================================================
# OUTPUT & REPORTS [SHARED]
# ============================================================================
output:
  # Output directory for reports
  directory: ./reports

  # Report formats to generate
  formats:
    json: true
    markdown: true
    docx: true       # Requires pandoc: brew install pandoc (macOS) or apt-get install pandoc (Linux)
    pdf: false       # Requires wkhtmltopdf or weasyprint

  # Report content options
  include_change_summary: true
  include_amendments: true
  highlight_changes: true
  include_audit_trail: true
  include_rubric_details: true  # [V2 ONLY] Include rubric scoring details

# ============================================================================
# DEEP RESEARCH [SHARED] (Optional)
# ============================================================================
deep_research:
  enabled: false
  agent: deep-research-pro-preview-12-2025
  poll_interval: 10
  max_wait: 3600

# ============================================================================
# RATE LIMITING [SHARED]
# ============================================================================
rate_limiting:
  congress_delay: 0.5
  regulations_delay: 0.5
  legiscan_delay: 0.5
  openstates_delay: 0.5
